!!!
%html{:xmlns => "http://www.w3.org/1999/xhtml", :"xml:lang" =>"en", :lang =>"en"}
  %head
    :javascript
      if((navigator.userAgent.match(/iPhone/i)) || (navigator.userAgent.match(/iPod/i)))
        {
        location.href='/iphone';
        }
    %title== Ftang! Player
    %script{:type => "text/javascript", :src => "http://jqueryjs.googlecode.com/files/jquery-1.3.js"}
    %script{:type => "text/javascript", :src => "/jquery.jplayer.js"}
    %script{:type => "text/javascript", :src => "http://www.google-analytics.com/urchin.js"}
    
    %link{:rel => "stylesheet", :type => "text/css", :href => "/jplayer.css"}

  %body
    #header
      %h2
        %a{:href => '/'}
          FTANG!
        >
        %a{:href => "/play/#{params[:artist]}"}
          =params[:artist]
        >
        %a{:href => "/play/#{params[:artist]}/#{params[:album]}"}
          =params[:album]
    #jquery_jplayer
    #player_container
      %ul#player_controls
        %li#player_play
          %a{ :href => "#", :onClick => "$('#jquery_jplayer').play(); return false;", :title => "play" }
            %span
              play
        %li#player_pause
          %a{ :href => "#", :onClick => "$('#jquery_jplayer').pause(); return false;", :title => "pause" }
            %span
              pause
        %li#player_stop
          %a{ :href => "#", :onClick => "$('#jquery_jplayer').stop(); return false;", :title => "stop" }
            %span
              stop
        %li#player_volume_min
          %a{ :href => "#", :onClick => "$('#jquery_jplayer').volume(0); return false;", :title => "min volume" }
            %span
              min volume
        %li#player_volume_max
          %a{ :href => "#", :onClick => "$('#jquery_jplayer').volume(100); return false;", :title => "max volume" }
            %span
              max volume
        %li#ctrl_prev
          %a{ :href => "#", :title => "previous track", :onclick => "playListPrev(); return false;" }
            %span
              previous
        %li#ctrl_next
          %a{ :href => "#", :title => "next track", :onclick => "playListPrev(); return false;" }
            %span
              next
      #play_time
      #total_time
      #player_progress
        #player_progress_load_bar
          #player_progress_play_bar
      #player_volume_bar
        #player_volume_bar_value
    #playlist_list
      %ul
      %p{:style => "padding-left:10px"}
        %i
          all music here is licensed and subject to the stipulations of the DMCA. do not download, modify, or distribute these files. questions?
          %a{:href => "http://www.maxogden.com", :style => "color: #00c0f3"}
            contact me
    #album_cover
      -unless @cover.nil?
        %img{:src => @cover, :id => "album_cover_image"}
  
  :javascript
    
    $(document).ready(function(){

      try {
      _uacct = "UA-9156272-1";
      urchinTracker();
      } catch(err) {}

      var usePlayList = false;
      var playItem = 0;

      var myPlayList = 
      #{@playlist}

      $("#jquery_jplayer").jPlayer({
        ready: function() {
          displayPlayList();
          playListEnable(true);
        }
      });

      $("#jquery_jplayer").jPlayerId("play", "player_play");
      $("#jquery_jplayer").jPlayerId("pause", "player_pause");
      $("#jquery_jplayer").jPlayerId("stop", "player_stop");
      $("#jquery_jplayer").jPlayerId("loadBar", "player_progress_load_bar");
      $("#jquery_jplayer").jPlayerId("playBar", "player_progress_play_bar");
      $("#jquery_jplayer").jPlayerId("volumeMin", "player_volume_min");
      $("#jquery_jplayer").jPlayerId("volumeMax", "player_volume_max");
      $("#jquery_jplayer").jPlayerId("volumeBar", "player_volume_bar");
      $("#jquery_jplayer").jPlayerId("volumeBarValue", "player_volume_bar_value");

      $("#jquery_jplayer").onProgressChange( function(loadPercent, playedPercentRelative, playedPercentAbsolute, playedTime, totalTime) {
        var myPlayedTime = new Date(playedTime);
        var ptMin = (myPlayedTime.getMinutes() < 10) ? "0" + myPlayedTime.getMinutes() : myPlayedTime.getMinutes();
        var ptSec = (myPlayedTime.getSeconds() < 10) ? "0" + myPlayedTime.getSeconds() : myPlayedTime.getSeconds();
        $("#play_time").text(ptMin+":"+ptSec);

        var myTotalTime = new Date(totalTime);
        var ttMin = (myTotalTime.getMinutes() < 10) ? "0" + myTotalTime.getMinutes() : myTotalTime.getMinutes();
        var ttSec = (myTotalTime.getSeconds() < 10) ? "0" + myTotalTime.getSeconds() : myTotalTime.getSeconds();
        $("#total_time").text(ttMin+":"+ttSec);
      });

      $("#jquery_jplayer").onSoundComplete(endOfSong);

      $("#ctrl_prev").click( function() {
        playListPrev();
        return false;
      });

      $("#ctrl_next").click( function() {
        playListNext();
        return false;
      });

      function endOfSong() {
        if(usePlayList) {
          playListNext();
        }
      }
    
      function displayPlayList() {
        for (i=0; i < myPlayList.length; i++) {
          $("#playlist_list ul").append("<li id='playlist_item_"+i+"'>"+ myPlayList[i].name +"</li>");
          $("#playlist_item_"+i).data( "index", i ).hover(
            function() {
              if (playItem != $(this).data("index")) {
                $(this).addClass("playlist_hover");
              }
            },
            function() {
              $(this).removeClass("playlist_hover");
            }
          ).click( function() {
            var index = $(this).data("index");
            if (playItem != index) {
              playListChange( index );
            }
          });
        }
      }

      function playListEnable(e) {
        usePlayList = e;
        if(usePlayList) {
          playListChange( playItem );
        } else {
          $("#jquery_jplayer").stop();
          $("#player_playlist_message").text("Playlists disabled");
        }
      }

      function playListChange( index ) {
        $("#playlist_item_"+playItem).removeClass("playlist_current");
        $("#playlist_item_"+index).addClass("playlist_current");
        playItem = index;
        $("#jquery_jplayer").changeAndPlay(myPlayList[playItem].filename);
        // $("#player_playlist_message").text(myPlayList[playItem].name);
      }

      function playListNext() {
        if(usePlayList) {
          var index = (playItem+1 < myPlayList.length) ? playItem+1 : 0;
          playListChange( index );
        }
      }

      function playListPrev() {
        if(usePlayList) {
          var index = (playItem-1 >= 0) ? playItem-1 : myPlayList.length-1;
          playListChange( index );
        }
      }
    });
