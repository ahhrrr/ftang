!!!
%html{:xmlns => "http://www.w3.org/1999/xhtml", :"xml:lang" =>"en", :lang =>"en"}
  %head
    :javascript
      if((navigator.userAgent.match(/iPhone/i)) || (navigator.userAgent.match(/iPod/i)))
        {
        location.href='/iphone';
        }
    %title== Ftang! Player
    %script{:type => "text/javascript", :src => "http://jqueryjs.googlecode.com/files/jquery-1.3.js"}
    %script{:type => "text/javascript", :src => "/jquery.jplayer.js"}
    %script{:type => "text/javascript", :src => "http://www.google-analytics.com/urchin.js"}
    
    %link{:rel => "stylesheet", :type => "text/css", :href => "/jplayer.css"}

  %body
    #header
      %h2
        %a{:href => '/'}
          FTANG!
        >
        %a{:href => "/play/#{params[:artist]}"}
          =params[:artist]
        >
        %a{:href => "/play/#{params[:artist]}/#{params[:album]}"}
          =params[:album]
    #jquery_jplayer
    #player_container
      %ul#player_controls
        %li#player_play
          play
        %li#player_pause
          pause
        %li#player_stop
          stop
        %li#player_volume_min
          min volume
        %li#player_volume_max
          max volume
        %li#ctrl_prev
          previous
        %li#ctrl_next
          next
      #play_time
      #total_time
      #player_progress
        #player_progress_load_bar
          #player_progress_play_bar
      #player_volume_bar
        #player_volume_bar_value
    #playlist_list
      %ul
      %p{:style => "padding-left:10px"}
        %i
          all music here is licensed and subject to the stipulations of the DMCA. do not download, modify, or distribute these files. questions?
          %a{:href => "http://www.maxogden.com", :style => "color: #00c0f3"}
            contact me
    #album_cover
      - unless @cover.nil?
        %img{:src => @cover, :id => "album_cover_image"}
  
  :javascript
    
    $(document).ready(function(){

      try {
      _uacct = "UA-9156272-1";
      urchinTracker();
      } catch(err) {}

      var playItem = 0;

      var myPlayList = 
      #{@playlist}

      $("#jquery_jplayer").jPlayer({
        ready: function() {
          displayPlayList();
          playListInit(true); // Parameter is a boolean for autoplay.
        },
        oggSupport: false
      })
      .jPlayerId("play", "player_play")
      .jPlayerId("pause", "player_pause")
      .jPlayerId("stop", "player_stop")
      .jPlayerId("loadBar", "player_progress_load_bar")
      .jPlayerId("playBar", "player_progress_play_bar")
      .jPlayerId("volumeMin", "player_volume_min")
      .jPlayerId("volumeMax", "player_volume_max")
      .jPlayerId("volumeBar", "player_volume_bar")
      .jPlayerId("volumeBarValue", "player_volume_bar_value")
      .onProgressChange( function(loadPercent, playedPercentRelative, playedPercentAbsolute, playedTime, totalTime) {
        var myPlayedTime = new Date(playedTime);
        var ptMin = (myPlayedTime.getUTCMinutes() < 10) ? "0" + myPlayedTime.getUTCMinutes() : myPlayedTime.getUTCMinutes();
        var ptSec = (myPlayedTime.getUTCSeconds() < 10) ? "0" + myPlayedTime.getUTCSeconds() : myPlayedTime.getUTCSeconds();
        $("#play_time").text(ptMin+":"+ptSec);

        var myTotalTime = new Date(totalTime);
        var ttMin = (myTotalTime.getUTCMinutes() < 10) ? "0" + myTotalTime.getUTCMinutes() : myTotalTime.getUTCMinutes();
        var ttSec = (myTotalTime.getUTCSeconds() < 10) ? "0" + myTotalTime.getUTCSeconds() : myTotalTime.getUTCSeconds();
        $("#total_time").text(ttMin+":"+ttSec);
      })
      .onSoundComplete( function() {
        playListNext();
      });

      $("#ctrl_prev").click( function() {
        playListPrev();
        return false;
      });

      $("#ctrl_next").click( function() {
        playListNext();
        return false;
      });

      function displayPlayList() {
        for (i=0; i < myPlayList.length; i++) {
          $("#playlist_list ul").append("<li id='playlist_item_"+i+"'>"+ myPlayList[i].name +"</li>");
          $("#playlist_item_"+i).data( "index", i ).hover(
            function() {
              if (playItem != $(this).data("index")) {
                $(this).addClass("playlist_hover");
              }
            },
            function() {
              $(this).removeClass("playlist_hover");
            }
          ).click( function() {
            var index = $(this).data("index");
            if (playItem != index) {
              playListChange( index );
            } else {
              $("#jquery_jplayer").play();
            }
          });
        }
      }

      function playListInit(autoplay) {
        if(autoplay) {
          playListChange( playItem );
        } else {
          playListConfig( playItem );
        }
      }

      function playListConfig( index ) {
        $("#playlist_item_"+playItem).removeClass("playlist_current");
        $("#playlist_item_"+index).addClass("playlist_current");
        playItem = index;
        $("#jquery_jplayer").setFile(myPlayList[playItem].mp3, myPlayList[playItem].ogg);
      }

      function playListChange( index ) {
        playListConfig( index );
        $("#jquery_jplayer").play();
      }

      function playListNext() {
        var index = (playItem+1 < myPlayList.length) ? playItem+1 : 0;
        playListChange( index );
      }

      function playListPrev() {
        var index = (playItem-1 >= 0) ? playItem-1 : myPlayList.length-1;
        playListChange( index );
      }
      });